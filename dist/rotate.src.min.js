!function(t){"use strict";var e=function(t){return t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||function(e){t.setTimeout(e,1e3/60)}}(t),i=function(t){var e=arguments.length;if(e<2)return t||{};for(var i=1;i<e;i++)for(var s=arguments[i],a=Object.keys(s),n=a.length,o=0;o<n;o++){var h=a[o];t[h]=s[h]}return t},s={cx:0,cy:0,angle:0,speed:0,inertia:0,minimalSpeed:.001,minimalAngleChange:.1,step:0,stepTransitionTime:0,stepTransitionEasing:"linear"},a=function(t){this.init(t)};a.prototype={options:s,init:function(t){this.options=i({},this.options,t),this.eventHandlers=[],this._initState(),this._bindHandlers(),this._update()},onRotationStart:function(t){this.state.active=!0,this.state.speed=0,this.state.lastMouseAngle=void 0,this.state.lastElementAngle=void 0,this.state.lastMouseEvent=void 0,this.state.startMouseEvent=this._normalizeEvent(t),this.trigger("rotate.start",this.state)},onRotated:function(t){!0===this.state.active&&(this.state.lastMouseEvent=this._normalizeEvent(t))},onRotationStop:function(){this.state.active=!1,this.trigger("rotate.stop",this.state)},trigger:function(t,e){this.eventHandlers.filter(function(e){return e.event===t}).forEach(function(t){t.callback.call(t.context||this,e)})},on:function(t,e,i){this.eventHandlers.push({event:t,callback:e,context:i})},off:function(t,e,i){this.eventHandlers=this.eventHandlers.filter(function(s){return!(t===s.event&&e===s.callback&&i===s.context)})},_normalizeEvent:function(t){const e={};return void 0!==t.targetTouches&&void 0!==t.targetTouches[0]?(e.pageX=t.targetTouches[0].pageX,e.pageY=t.targetTouches[0].pageY):(e.pageX=t.pageX||t.clientX,e.pageY=t.pageY||t.clientY),e},_bindHandlers:function(){this._update=this._update.bind(this),this.onRotationStart=this.onRotationStart.bind(this),this.onRotated=this.onRotated.bind(this),this.onRotationStop=this.onRotationStop.bind(this)},_triggerOnRotate:function(){void 0!==this._direction&&this._direction===this.state.direction||(this._direction=this.state.direction,this.trigger("rotate.changeDirection",this.state.direction)),this.trigger("rotate.progress",this.state)},_initState:function(){var t=this,e=t.options;t.state={cx:e.cx,cy:e.cy,direction:0,active:!1,transiting:!1,step:e.step||s.step,stepTransitionTime:e.stepTransitionTime||s.stepTransitionTime,stepTransitionEasing:e.stepTransitionEasing||s.stepTransitionEasing,speed:e.speed||s.speed,inertia:e.inertia||s.inertia,minimalSpeed:e.inertia||s.inertia,lastAppliedAngle:null,minimalAngleChange:null,get angle(){return this._angle},set angle(e){this._angle=e,this.virtualAngle=e,t._triggerOnRotate()}},t.state.angle=e.angle||s.angle,t.state.lastAppliedAngle=t.state.virtualAngle=t.state._angle=e.angle||s.angle,t.state.minimalAngleChange=t.state.step!==s.step?t.state.step:s.minimalAngleChange},_update:function(){void 0!==this.state.lastMouseEvent&&!0===this.state.active&&this._updateAngleToMouse(this.state.lastMouseEvent),this._updateAngle(),this._applySpeed(),this._applyInertia();const t=this.state.lastAppliedAngle-this.state._angle;Math.abs(t)>=this.state.minimalAngleChange&&!1===this.state.transiting&&(this._getDirection(),this._triggerOnRotate(),this._blockTransition(),this.trigger("rotate.progress",this.state),this.state.lastAppliedAngle=this.state._angle),e(this._update)},_updateAngleToMouse:function(t){var e=t.pageX-this.state.cx,i=t.pageY-this.state.cy,a=Math.atan2(e,i),n=a*(180/Math.PI*-1)+180;if(void 0===this.state.lastMouseAngle&&(this.state.lastElementAngle=this.state.virtualAngle,this.state.lastMouseAngle=n),this.state.stepTransitionTime!==s.stepTransitionTime)this.state.speed=this.state.mouseDiff=this._differenceBetweenAngles(n,this.state.lastMouseAngle),this.state.virtualAngle=this.state.lastElementAngle+this.state.mouseDiff,this.state.lastElementAngle=this.state.virtualAngle,this.state.lastMouseAngle=n;else{var o=this.state.virtualAngle;this.state.mouseDiff=n-this.state.lastMouseAngle,this.state.virtualAngle=this.state.lastElementAngle+this.state.mouseDiff;var h=this.state.virtualAngle;this.state.speed=this._differenceBetweenAngles(h,o)}},_differenceBetweenAngles:function(t,e){var i=t*(Math.PI/180),s=e*(Math.PI/180),a=Math.atan2(Math.sin(i-s),Math.cos(i-s)),n=a*(180/Math.PI);return Math.round(100*n)/100},_getDirection:function(){const t=this.state.startMouseEvent,e=this.state.lastMouseEvent;if(e&&t){const i=Math.atan2(t.pageY-this.state.cy,t.pageX-this.state.cx),s=Math.atan2(e.pageY-this.state.cy,e.pageX-this.state.cx),a=(s-i)*(180/Math.PI),n=a>0&&a<180?1:a>-180&&a<0?-1:0;0!==n&&(this.state.direction=n)}this.state.startMouseEvent=e},_updateAngle:function(){this.state.step>0?this.state._angle=this._getAngleFromVirtual():this.state._angle=this._normalizeAngle(this.state.virtualAngle)},_getAngleFromVirtual:function(){return Math.ceil(this.state.virtualAngle/this.state.step)*this.state.step},_normalizeAngle:function(t){var e=t%360;return e<0&&(e=360+e),e},_applySpeed:function(){this.state.inertia>0&&0!==this.state.speed&&!1===this.state.active&&(this.state.virtualAngle+=this.state.speed)},_applyInertia:function(){this.state.inertia>0&&(Math.abs(this.state.speed)>=this.state.minimalSpeed?(this.state.speed=this.state.speed*this.state.inertia,!1===this.state.active&&Math.abs(this.state.speed)<this.state.minimalSpeed&&this.trigger("rotate.stop",this.state)):0!==this.state.speed&&(this.state.speed=0))},_blockTransition:function(){if(this.state.stepTransitionTime!==s.stepTransitionTime){var t=this;setTimeout(function(){t.state.transiting=!1},t.state.stepTransitionTime),t.state.transiting=!0}}},t.RotateJS=a}(window);