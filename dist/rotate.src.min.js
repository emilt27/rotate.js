!function(t){"use strict";var e=function(t){return t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||function(e){t.setTimeout(e,1e3/60)}}(t),s=function(t){var e=arguments.length;if(e<2)return t||{};for(var s=1;s<e;s++)for(var i=arguments[s],a=Object.keys(i),n=a.length,o=0;o<n;o++){var h=a[o];t[h]=i[h]}return t},i={cx:0,cy:0,angle:0,speed:0,inertia:0,minimalSpeed:.001,minimalAngleChange:.1,step:0,stepTransitionTime:0,stepTransitionEasing:"linear"},a=function(t){this.init(t)};a.prototype={options:i,init:function(t){this.options=s({},this.options,t),this.eventHandlers=[],this._initState(),this._bindHandlers(),this._update()},onRotationStart:function(){this.state.active=!0,this.state.speed=0,this.state.lastMouseAngle=void 0,this.state.lastElementAngle=void 0,this.state.lastMouseEvent=void 0,this.trigger("rotate.start",this.state)},onRotated:function(t){!0===this.state.active&&(void 0!==t.targetTouches&&void 0!==t.targetTouches[0]?this.state.lastMouseEvent={pageX:t.targetTouches[0].pageX,pageY:t.targetTouches[0].pageY}:this.state.lastMouseEvent={pageX:t.pageX||t.clientX,pageY:t.pageY||t.clientY})},onRotationStop:function(){this.state.active=!1,this.trigger("rotate.stop",this.state)},trigger:function(t,e){this.eventHandlers.filter(function(e){return e.event===t}).forEach(function(t){t.callback.call(t.context||this,e)})},on:function(t,e,s){this.eventHandlers.push({event:t,callback:e,context:s})},off:function(t,e,s){this.eventHandlers=this.eventHandlers.filter(function(i){return!(t===i.event&&e===i.callback&&s===i.context)})},_bindHandlers:function(){this._update=this._update.bind(this),this.onRotationStart=this.onRotationStart.bind(this),this.onRotated=this.onRotated.bind(this),this.onRotationStop=this.onRotationStop.bind(this)},_triggerOnRotate:function(t){const e=0!==t&&t>0?1:-1;this.state.direction!==e&&this.trigger("rotate.changeDirection",e),this.trigger("rotate.progress",this.state)},_initState:function(){var t=this,e=t.options;t.state={cx:e.cx,cy:e.cy,active:!1,transiting:!1,step:e.step||i.step,stepTransitionTime:e.stepTransitionTime||i.stepTransitionTime,stepTransitionEasing:e.stepTransitionEasing||i.stepTransitionEasing,speed:e.speed||i.speed,inertia:e.inertia||i.inertia,minimalSpeed:e.inertia||i.inertia,lastAppliedAngle:null,minimalAngleChange:null,get angle(){return this._angle},set angle(e){this._angle=e,this.virtualAngle=e,t._triggerOnRotate(e)}},t.state.angle=e.angle||i.angle,t.state.lastAppliedAngle=t.state.virtualAngle=t.state._angle=e.angle||i.angle,t.state.minimalAngleChange=t.state.step!==i.step?t.state.step:i.minimalAngleChange},_update:function(){void 0!==this.state.lastMouseEvent&&!0===this.state.active&&this._updateAngleToMouse(this.state.lastMouseEvent),this._updateAngle(),this._applySpeed(),this._applyInertia();const t=this.state.lastAppliedAngle-this.state._angle;Math.abs(t)>=this.state.minimalAngleChange&&!1===this.state.transiting&&(this._triggerOnRotate(t),this._blockTransition(),this.trigger("rotate.progress",this.state),this.state.lastAppliedAngle=this.state._angle),e(this._update)},_updateAngleToMouse:function(t){var e=t.pageX-this.state.cx,s=t.pageY-this.state.cy,a=Math.atan2(e,s),n=a*(180/Math.PI*-1)+180;if(void 0===this.state.lastMouseAngle&&(this.state.lastElementAngle=this.state.virtualAngle,this.state.lastMouseAngle=n),this.state.stepTransitionTime!==i.stepTransitionTime)this.state.speed=this.state.mouseDiff=this._differenceBetweenAngles(n,this.state.lastMouseAngle),this.state.virtualAngle=this.state.lastElementAngle+this.state.mouseDiff,this.state.lastElementAngle=this.state.virtualAngle,this.state.lastMouseAngle=n;else{var o=this.state.virtualAngle;this.state.mouseDiff=n-this.state.lastMouseAngle,this.state.virtualAngle=this.state.lastElementAngle+this.state.mouseDiff;var h=this.state.virtualAngle;this.state.speed=this._differenceBetweenAngles(h,o)}},_differenceBetweenAngles:function(t,e){var s=t*(Math.PI/180),i=e*(Math.PI/180),a=Math.atan2(Math.sin(s-i),Math.cos(s-i)),n=a*(180/Math.PI);return Math.round(100*n)/100},_updateAngle:function(){this.state.step>0?this.state._angle=this._getAngleFromVirtual():this.state._angle=this._normalizeAngle(this.state.virtualAngle)},_getAngleFromVirtual:function(){return Math.ceil(this.state.virtualAngle/this.state.step)*this.state.step},_normalizeAngle:function(t){var e=t%360;return e<0&&(e=360+e),e},_applySpeed:function(){this.state.inertia>0&&0!==this.state.speed&&!1===this.state.active&&(this.state.virtualAngle+=this.state.speed)},_applyInertia:function(){this.state.inertia>0&&(Math.abs(this.state.speed)>=this.state.minimalSpeed?(this.state.speed=this.state.speed*this.state.inertia,!1===this.state.active&&Math.abs(this.state.speed)<this.state.minimalSpeed&&this.trigger("rotate.stop",this.state)):0!==this.state.speed&&(this.state.speed=0))},_blockTransition:function(){if(this.state.stepTransitionTime!==i.stepTransitionTime){var t=this;setTimeout(function(){t.state.transiting=!1},t.state.stepTransitionTime),t.state.transiting=!0}}},t.RotateJS=a}(window);